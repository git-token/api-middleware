'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _stringify = require('babel-runtime/core-js/json/stringify');

var _stringify2 = _interopRequireDefault(_stringify);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _web = require('web3');

var _web2 = _interopRequireDefault(_web);

var _express = require('express');

var _express2 = _interopRequireDefault(_express);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _KeystoreGenerator2 = require('./KeystoreGenerator');

var _KeystoreGenerator3 = _interopRequireDefault(_KeystoreGenerator2);

var _index = require('./smtp/index');

var _index2 = require('./websocket/index');

var _index3 = require('./utils/index');

var _index4 = require('./api/index');

var _index5 = _interopRequireDefault(_index4);

var _index6 = require('./sqlite/index');

var _index7 = _interopRequireDefault(_index6);

var _index8 = require('./hyperlog/index');

var _index9 = require('./events/index');

var _index10 = require('./contract/index');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var GitTokenContract = '{\n  "contract_name": "GitToken",\n  "abi": [\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_rewardType",\n          "type": "string"\n        }\n      ],\n      "name": "getRewardDetails",\n      "outputs": [\n        {\n          "name": "",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_spender",\n          "type": "address"\n        },\n        {\n          "name": "_value",\n          "type": "uint256"\n        }\n      ],\n      "name": "approve",\n      "outputs": [],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [],\n      "name": "totalSupply",\n      "outputs": [\n        {\n          "name": "",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_username",\n          "type": "string"\n        }\n      ],\n      "name": "getContributorAddress",\n      "outputs": [\n        {\n          "name": "",\n          "type": "address"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_from",\n          "type": "address"\n        },\n        {\n          "name": "_to",\n          "type": "address"\n        },\n        {\n          "name": "_value",\n          "type": "uint256"\n        }\n      ],\n      "name": "transferFrom",\n      "outputs": [],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [],\n      "name": "organization",\n      "outputs": [\n        {\n          "name": "",\n          "type": "string"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [],\n      "name": "decimals",\n      "outputs": [\n        {\n          "name": "",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_username",\n          "type": "string"\n        },\n        {\n          "name": "_rewardType",\n          "type": "string"\n        },\n        {\n          "name": "_rewardBonus",\n          "type": "uint256"\n        },\n        {\n          "name": "_deliveryID",\n          "type": "string"\n        }\n      ],\n      "name": "rewardContributor",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_rewardValue",\n          "type": "uint256"\n        },\n        {\n          "name": "_rewardType",\n          "type": "string"\n        }\n      ],\n      "name": "setRewardValue",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "",\n          "type": "address"\n        }\n      ],\n      "name": "owner",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_contributor",\n          "type": "address"\n        }\n      ],\n      "name": "balanceOf",\n      "outputs": [\n        {\n          "name": "",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_username",\n          "type": "string"\n        }\n      ],\n      "name": "getUnclaimedRewards",\n      "outputs": [\n        {\n          "name": "",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [],\n      "name": "symbol",\n      "outputs": [\n        {\n          "name": "",\n          "type": "string"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_to",\n          "type": "address"\n        },\n        {\n          "name": "_value",\n          "type": "uint256"\n        }\n      ],\n      "name": "transfer",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_username",\n          "type": "string"\n        },\n        {\n          "name": "_code",\n          "type": "bytes"\n        }\n      ],\n      "name": "setContributor",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_contributor",\n          "type": "address"\n        },\n        {\n          "name": "_username",\n          "type": "string"\n        }\n      ],\n      "name": "verifyContributor",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_owner",\n          "type": "address"\n        },\n        {\n          "name": "_spender",\n          "type": "address"\n        }\n      ],\n      "name": "allowance",\n      "outputs": [\n        {\n          "name": "",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "newOwner",\n          "type": "address"\n        }\n      ],\n      "name": "transferOwnership",\n      "outputs": [],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "inputs": [\n        {\n          "name": "_contributor",\n          "type": "address"\n        },\n        {\n          "name": "_username",\n          "type": "string"\n        },\n        {\n          "name": "_organization",\n          "type": "string"\n        },\n        {\n          "name": "_symbol",\n          "type": "string"\n        },\n        {\n          "name": "_decimals",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "constructor"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": true,\n          "name": "owner",\n          "type": "address"\n        },\n        {\n          "indexed": true,\n          "name": "spender",\n          "type": "address"\n        },\n        {\n          "indexed": false,\n          "name": "value",\n          "type": "uint256"\n        }\n      ],\n      "name": "Approval",\n      "type": "event"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": true,\n          "name": "from",\n          "type": "address"\n        },\n        {\n          "indexed": true,\n          "name": "to",\n          "type": "address"\n        },\n        {\n          "indexed": false,\n          "name": "value",\n          "type": "uint256"\n        }\n      ],\n      "name": "Transfer",\n      "type": "event"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": true,\n          "name": "contributor",\n          "type": "address"\n        },\n        {\n          "indexed": false,\n          "name": "value",\n          "type": "uint256"\n        },\n        {\n          "indexed": false,\n          "name": "date",\n          "type": "uint256"\n        },\n        {\n          "indexed": false,\n          "name": "rewardType",\n          "type": "string"\n        }\n      ],\n      "name": "Contribution",\n      "type": "event"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": true,\n          "name": "contributor",\n          "type": "address"\n        },\n        {\n          "indexed": false,\n          "name": "date",\n          "type": "uint256"\n        }\n      ],\n      "name": "ContributorVerified",\n      "type": "event"\n    }\n  ],\n  "unlinked_binary": "0x606060405234156200000d57fe5b6040516200279238038062002792833981016040908152815160208301519183015160608401516080850151929493840193918201929101905b5b600160a060020a0333166000908152602081905260409020805460ff191660011790555b600160a060020a03851615620000a057600160a060020a0385166000908152602081905260409020805460ff191660011790555b60006001558251620000ba90600390602086019062000bf4565b508151620000d090600490602085019062000bf4565b506002819055600160a060020a03331660009081526006602090815260409091208551620001019287019062000bf4565b50600160a060020a038516600090815260066020908152604090912085516200012d9287019062000bf4565b50846001600601856040518082805190602001908083835b60208310620001665780518252601f19909201916020918201910162000145565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060006101000a815481600160a060020a030219169083600160a060020a0316021790555080600a0a6109c402600160040160405180807f70696e6700000000000000000000000000000000000000000000000000000000815250600401905090815260200160405180910390208190555080600a0a60fa02600160040160405180807f636f6d6d6974436f6d6d656e7400000000000000000000000000000000000000815250600d01905090815260200160405180910390208190555080600a0a6109c402600160040160405180807f6372656174650000000000000000000000000000000000000000000000000000815250600601905090815260200160405180910390208190555080600a0a600002600160040160405180807f64656c6574650000000000000000000000000000000000000000000000000000815250600601905090815260200160405180910390208190555080600a0a61138802600160040160405180807f6465706c6f796d656e7400000000000000000000000000000000000000000000815250600a01905090815260200160405180910390208190555080600a0a606402600160040160405180807f6465706c6f796d656e7453746174757300000000000000000000000000000000815250601001905090815260200160405180910390208190555080600a0a61138802600160040160405180807f666f726b00000000000000000000000000000000000000000000000000000000815250600401905090815260200160405180910390208190555080600a0a60fa02600160040160405180807f676f6c6c756d0000000000000000000000000000000000000000000000000000815250600601905090815260200160405180910390208190555080600a0a60fa02600160040160405180807f696e7374616c6c6174696f6e0000000000000000000000000000000000000000815250600c01905090815260200160405180910390208190555080600a0a6103e802600160040160405180807f696e7374616c6c6174696f6e5265706f7369746f726965730000000000000000815250601801905090815260200160405180910390208190555080600a0a60fa02600160040160405180807f6973737565436f6d6d656e740000000000000000000000000000000000000000815250600c01905090815260200160405180910390208190555080600a0a6101f402600160040160405180807f6973737565730000000000000000000000000000000000000000000000000000815250600601905090815260200160405180910390208190555080600a0a606402600160040160405180807f6c6162656c000000000000000000000000000000000000000000000000000000815250600501905090815260200160405180910390208190555080600a0a600002600160040160405180807f6d61726b6574706c616365507572636861736500000000000000000000000000815250601301905090815260200160405180910390208190555080600a0a6103e802600160040160405180807f6d656d6265720000000000000000000000000000000000000000000000000000815250600601905090815260200160405180910390208190555080600a0a6103e802600160040160405180807f6d656d6265727368697000000000000000000000000000000000000000000000815250600a01905090815260200160405180910390208190555080600a0a613a9802600160040160405180807f6d696c6573746f6e650000000000000000000000000000000000000000000000815250600901905090815260200160405180910390208190555080600a0a6103e802600160040160405180807f6f7267616e697a6174696f6e0000000000000000000000000000000000000000815250600c01905090815260200160405180910390208190555080600a0a600002600160040160405180807f6f7267426c6f636b000000000000000000000000000000000000000000000000815250600801905090815260200160405180910390208190555080600a0a6101f402600160040160405180807f706167654275696c640000000000000000000000000000000000000000000000815250600901905090815260200160405180910390208190555080600a0a60fa02600160040160405180807f70726f6a65637443617264000000000000000000000000000000000000000000815250600b01905090815260200160405180910390208190555080600a0a603202600160040160405180807f70726f6a656374436f6c756d6e00000000000000000000000000000000000000815250600d01905090815260200160405180910390208190555080600a0a6103e802600160040160405180807f70726f6a65637400000000000000000000000000000000000000000000000000815250600701905090815260200160405180910390208190555080600a0a61271002600160040160405180807f7075626c69630000000000000000000000000000000000000000000000000000815250600601905090815260200160405180910390208190555080600a0a60fa02600160040160405180807f70756c6c5f726571756573745f7265766965775f636f6d6d656e740000000000815250601b01905090815260200160405180910390208190555080600a0a606402600160040160405180807f70756c6c5f726571756573745f72657669657700000000000000000000000000815250601301905090815260200160405180910390208190555080600a0a60fa02600160040160405180807f70756c6c5f726571756573740000000000000000000000000000000000000000815250600c01905090815260200160405180910390208190555080600a0a6103e802600160040160405180807f7075736800000000000000000000000000000000000000000000000000000000815250600401905090815260200160405180910390208190555080600a0a6109c402600160040160405180807f7265706f7369746f727900000000000000000000000000000000000000000000815250600a01905090815260200160405180910390208190555080600a0a61138802600160040160405180807f72656c6561736500000000000000000000000000000000000000000000000000815250600701905090815260200160405180910390208190555080600a0a60c802600160040160405180807f7374617475730000000000000000000000000000000000000000000000000000815250600601905090815260200160405180910390208190555080600a0a6107d002600160040160405180807f7465616d00000000000000000000000000000000000000000000000000000000815250600401905090815260200160405180910390208190555080600a0a6107d002600160040160405180807f7465616d5f616464000000000000000000000000000000000000000000000000815250600801905090815260200160405180910390208190555080600a0a6101f402600160040160405180807f776174636800000000000000000000000000000000000000000000000000000081525060050190509081526020016040518091039020819055505b505050505062000c9e565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1062000c3757805160ff191683800117855562000c67565b8280016001018555821562000c67579182015b8281111562000c6757825182559160200191906001019062000c4a565b5b5062000c7692915062000c7a565b5090565b62000c9b91905b8082111562000c76576000815560010162000c81565b5090565b90565b611ae48062000cae6000396000f300606060405236156100e05763ffffffff60e060020a600035041663025dabae81146100e2578063095ea7b31461014a57806318160ddd1461016b5780631e923ded1461018d57806323b872dd146101ff57806323bd4d7a14610226578063313ce567146102b6578063563235cc146102d857806366253c44146103c1578063666e1b391461042c57806370a082311461045c57806376500a7e1461048a57806395d89b41146104f2578063a9059cbb14610582578063b0cd70fd146105b5578063d85600ca1461065c578063dd62ed3e146106d0578063f2fde38b14610704575bfe5b34156100ea57fe5b610138600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284375094965061072295505050505050565b60408051918252519081900360200190f35b341561015257fe5b610169600160a060020a036004351660243561078f565b005b341561017357fe5b610138610845565b60408051918252519081900360200190f35b341561019557fe5b6101e3600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284375094965061084c95505050505050565b60408051600160a060020a039092168252519081900360200190f35b341561020757fe5b610169600160a060020a03600435811690602435166044356108c2565b005b341561022e57fe5b610236610934565b60408051602080825283518183015283519192839290830191850190808383821561027c575b80518252602083111561027c57601f19909201916020918201910161025c565b505050905090810190601f1680156102a85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156102be57fe5b6101386109cd565b60408051918252519081900360200190f35b34156102e057fe5b6103ad600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284375050604080516020601f89358b0180359182018390048302840183019094528083529799988101979196509182019450925082915084018382808284375050604080516020601f818a01358b0180359182018390048302840183018552818452989a8a359a9099940197509195509182019350915081908401838280828437509496506109d495505050505050565b604080519115158252519081900360200190f35b34156103c957fe5b60408051602060046024803582810135601f81018590048502860185019096528585526103ad9583359593946044949392909201918190840183828082843750949650610bcf95505050505050565b604080519115158252519081900360200190f35b341561043457fe5b6103ad600160a060020a0360043516610c6a565b604080519115158252519081900360200190f35b341561046457fe5b610138600160a060020a0360043516610c7f565b60408051918252519081900360200190f35b341561049257fe5b610138600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843750949650610c9e95505050505050565b60408051918252519081900360200190f35b34156104fa57fe5b610236610d0b565b60408051602080825283518183015283519192839290830191850190808383821561027c575b80518252602083111561027c57601f19909201916020918201910161025c565b505050905090810190601f1680156102a85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561058a57fe5b6103ad600160a060020a0360043516602435610da4565b604080519115158252519081900360200190f35b34156105bd57fe5b6103ad600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284375050604080516020601f89358b01803591820183900483028401830190945280835297999881019791965091820194509250829150840183828082843750949650610e1895505050505050565b604080519115158252519081900360200190f35b341561066457fe5b60408051602060046024803582810135601f81018590048502860185019096528585526103ad958335600160a060020a03169593946044949392909201918190840183828082843750949650610e4795505050505050565b604080519115158252519081900360200190f35b34156106d857fe5b610138600160a060020a0360043581169060243516610edc565b60408051918252519081900360200190f35b341561070c57fe5b610169600160a060020a0360043516610f09565b005b60006001600401826040518082805190602001908083835b602083106107595780518252601f19909201916020918201910161073a565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054925050505b919050565b604060443610156107a05760006000fd5b6000821180156107d55750600160a060020a033381166000908152600860209081526040808320938716835292905290812054115b156107e05760006000fd5b600160a060020a03338116600081815260086020908152604080832094881680845294825291829020869055815186815291517f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259281900390910190a35b5b5b505050565b6001545b90565b60006001600601826040518082805190602001908083835b602083106108835780518252601f199092019160209182019101610864565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054600160a060020a0316925050505b919050565b606060643610156108d35760006000fd5b6108e6600185858563ffffffff610f9016565b15156108f25760006000fd5b82600160a060020a031684600160a060020a0316600080516020611a99833981519152846040518082815260200191505060405180910390a35b5b5b50505050565b61093c6119e6565b6003805460408051602060026001851615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156109c25780601f10610997576101008083540402835291602001916109c2565b820191906000526020600020905b8154815290600101906020018083116109a557829003601f168201915b505050505090505b90565b6002545b90565b600160a060020a0333166000908152602081905260408120548190819060ff161515610a005760006000fd5b610a1460018888888863ffffffff61107516565b1515610a205760006000fd5b6001600601876040518082805190602001908083835b60208310610a555780518252601f199092019160209182019101610a36565b51815160209384036101000a60001901801990921691161790529201948552506040519384900381018420548a51600160a060020a039091169650610afc948a9450600593508b92909182918401908083835b60208310610ac75780518252601f199092019160209182019101610aa8565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054929150506113aa565b905081600160a060020a03167feb1d29659fe1e458a59d47ceab90b84b14e2eb79da4602088f9e9a8bcc228ca48242896040518084815260200183815260200180602001828103825283818151815260200191508051906020019080838360008314610b83575b805182526020831115610b8357601f199092019160209182019101610b63565b505050905090810190601f168015610baf5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a2600192505b5b5b5050949350505050565b600160a060020a03331660009081526020819052604081205460ff161515610bf75760006000fd5b826001600401836040518082805190602001908083835b60208310610c2d5780518252601f199092019160209182019101610c0e565b51815160209384036101000a60001901801990921691161790529201948552506040519384900301909220929092555060019150505b5b92915050565b60006020819052908152604090205460ff1681565b600160a060020a0381166000908152600960205260409020545b919050565b60006001600901826040518082805190602001908083835b602083106107595780518252601f19909201916020918201910161073a565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054925050505b919050565b610d136119e6565b6004805460408051602060026001851615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156109c25780601f10610997576101008083540402835291602001916109c2565b820191906000526020600020905b8154815290600101906020018083116109a557829003601f168201915b505050505090505b90565b600060406044361015610db75760006000fd5b610dc96001858563ffffffff6113c616565b1515610dd55760006000fd5b83600160a060020a031633600160a060020a0316600080516020611a99833981519152856040518082815260200191505060405180910390a35b5b5b5092915050565b6000610e2c6001848463ffffffff61144e16565b1515610e385760006000fd5b506001610c63565b5b92915050565b600160a060020a03331660009081526020819052604081205460ff161515610e6f5760006000fd5b610e816001848463ffffffff61176016565b1515610e8d5760006000fd5b604080514281529051600160a060020a038516917ffa9d9d86b3d6ec6b9069cfd9231a1f4e55884ff25c294686274441f354e7642f919081900360200190a2506001610c63565b5b5b92915050565b600160a060020a038083166000908152600860209081526040808320938516835292905220545b92915050565b600160a060020a03331660009081526020819052604090205460ff161515610f315760006000fd5b600160a060020a03811660009081526020819052604090205460ff161515610f8b57600160a060020a03808216600090815260208190526040808220805460ff199081166001179091553390931682529020805490911690555b5b5b50565b600160a060020a038084166000908152600786016020908152604080832033909416835292905290812054610fcb818463ffffffff6119bc16565b600160a060020a038087166000908152600789016020908152604080832033851684528252808320949094559187168152600889019091522054611015908463ffffffff6113aa16565b600160a060020a038086166000908152600889016020526040808220939093559087168152205461104c908463ffffffff6119bc16565b600160a060020a0386166000908152600888016020526040902055600191505b50949350505050565b6000600060006110e88589600401886040518082805190602001908083835b60208310610ac75780518252601f199092019160209182019101610aa8565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054929150506113aa565b915087600601876040518082805190602001908083835b6020831061111e5780518252601f1990920191602091820191016110ff565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054600160a060020a0316925050508115156111645760006000fd5b87600b01846040518082805190602001908083835b602083106111985780518252601f199092019160209182019101611179565b51815160001960209485036101000a0190811690199190911617905292019485525060405193849003019092205460ff1615156001141591506111dd90505760006000fd5b87546111ef908363ffffffff6113aa16565b8855600160a060020a03811615156112d95761126e8289600901896040518082805190602001908083835b60208310610ac75780518252601f199092019160209182019101610aa8565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054929150506113aa565b88600901886040518082805190602001908083835b602083106112a25780518252601f199092019160209182019101611283565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922092909255506113209050565b600160a060020a0381166000908152600889016020526040902054611304908363ffffffff6113aa16565b600160a060020a038216600090815260088a0160205260409020555b600188600b01856040518082805190602001908083835b602083106113565780518252601f199092019160209182019101611337565b51815160209384036101000a60001901801990921691161790529201948552506040519384900301909220805460ff191693151593909317909255506001935061139d9050565b5b5b505095945050505050565b60008282016113bb848210156119d5565b8091505b5092915050565b600160a060020a03331660009081526008840160205260408120546113f1908363ffffffff6119bc16565b600160a060020a0333811660009081526008870160205260408082209390935590851681522054611428908363ffffffff6113aa16565b600160a060020a03841660009081526008860160205260409020555060015b9392505050565b6000816040518082805190602001908083835b602083106114805780518252601f199092019160209182019101611461565b51815160209384036101000a60001901801990921691161790526040519190930181900381208851909550600a8a019450889391925082918401908083835b602083106114de5780518252601f1990920191602091820191016114bf565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092205492909214915061151c90505760006000fd5b600084600901846040518082805190602001908083835b602083106115525780518252601f199092019160209182019101611533565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390205411156116a75761161484600901846040518082805190602001908083835b602083106115c35780518252601f1990920191602091820191016115a4565b51815160209384036101000a6000190180199092169116179052920194855250604080519485900382019094205433600160a060020a0316600090815260088b0190925293902054929150506113aa565b84600801600033600160a060020a0316600160a060020a0316815260200190815260200160002081905550600084600901846040518082805190602001908083835b602083106116755780518252601f199092019160209182019101611656565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092209290925550505b600160a060020a0333166000908152600585016020908152604090912084516116d2928601906119f8565b503384600601846040518082805190602001908083835b602083106117085780518252601f1990920191602091820191016116e9565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092208054600160a060020a031916600160a060020a0394909416939093179092555060019150505b9392505050565b6000600160a060020a03831615156117785760006000fd5b600084600901836040518082805190602001908083835b602083106117ae5780518252601f19909201916020918201910161178f565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390205411156119035761187084600901836040518082805190602001908083835b6020831061181f5780518252601f199092019160209182019101611800565b51815160209384036101000a60001901801990921691161790529201948552506040805194859003820190942054600160a060020a038916600090815260088b0190925293902054929150506113aa565b84600801600085600160a060020a0316600160a060020a0316815260200190815260200160002081905550600084600901836040518082805190602001908083835b602083106118d15780518252601f1990920191602091820191016118b2565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092209290925550505b600160a060020a03831660009081526005850160209081526040909120835161192e928501906119f8565b508284600601836040518082805190602001908083835b602083106117085780518252601f1990920191602091820191016116e9565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092208054600160a060020a031916600160a060020a0394909416939093179092555060019150505b9392505050565b60006119ca838311156119d5565b508082035b92915050565b801515610f8b5760006000fd5b5b50565b60408051602081019091526000815290565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10611a3957805160ff1916838001178555611a66565b82800160010185558215611a66579182015b82811115611a66578251825591602001919060010190611a4b565b5b50611a73929150611a77565b5090565b61084991905b80821115611a735760008155600101611a7d565b5090565b905600ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa165627a7a72305820ab64de24fdfc12748791fbd33b653aa24e50e9f5068d0587ab3de3fc02862c510029",\n  "networks": {\n    "17": {\n      "links": {},\n      "events": {\n        "0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": true,\n              "name": "owner",\n              "type": "address"\n            },\n            {\n              "indexed": true,\n              "name": "spender",\n              "type": "address"\n            },\n            {\n              "indexed": false,\n              "name": "value",\n              "type": "uint256"\n            }\n          ],\n          "name": "Approval",\n          "type": "event"\n        },\n        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": true,\n              "name": "from",\n              "type": "address"\n            },\n            {\n              "indexed": true,\n              "name": "to",\n              "type": "address"\n            },\n            {\n              "indexed": false,\n              "name": "value",\n              "type": "uint256"\n            }\n          ],\n          "name": "Transfer",\n          "type": "event"\n        },\n        "0xeb1d29659fe1e458a59d47ceab90b84b14e2eb79da4602088f9e9a8bcc228ca4": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": true,\n              "name": "contributor",\n              "type": "address"\n            },\n            {\n              "indexed": false,\n              "name": "value",\n              "type": "uint256"\n            },\n            {\n              "indexed": false,\n              "name": "date",\n              "type": "uint256"\n            },\n            {\n              "indexed": false,\n              "name": "rewardType",\n              "type": "string"\n            }\n          ],\n          "name": "Contribution",\n          "type": "event"\n        },\n        "0xfa9d9d86b3d6ec6b9069cfd9231a1f4e55884ff25c294686274441f354e7642f": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": true,\n              "name": "contributor",\n              "type": "address"\n            },\n            {\n              "indexed": false,\n              "name": "date",\n              "type": "uint256"\n            }\n          ],\n          "name": "ContributorVerified",\n          "type": "event"\n        }\n      },\n      "updated_at": 1500174179136\n    }\n  },\n  "schema_version": "0.0.5",\n  "updated_at": 1500174179136\n}';

var GitTokenMiddleware = function (_KeystoreGenerator) {
  (0, _inherits3.default)(GitTokenMiddleware, _KeystoreGenerator);

  function GitTokenMiddleware(options) {
    (0, _classCallCheck3.default)(this, GitTokenMiddleware);

    var _this

    // bind utility methods to class scope


    /**
     * TODO Replace this with database
     */
    = (0, _possibleConstructorReturn3.default)(this, (GitTokenMiddleware.__proto__ || (0, _getPrototypeOf2.default)(GitTokenMiddleware)).call(this, options));

    var isGitHubHook = options.isGitHubHook,
        config = options.config,
        web3Provider = options.web3Provider,
        dirPath = options.dirPath,
        contractFile = options.contractFile,
        faucetActive = options.faucetActive;


    _this.faucetActive = faucetActive;
    _this.dirPath = dirPath;
    _this.contractFile = contractFile;
    _this.gittokenContract = JSON.parse(GitTokenContract);
    _this.isGitHubHook = isGitHubHook;
    _this.config = config;

    // this.dirPath = dirPath
    // this.web3Provider = web3Provider
    // this.web3 = new Web3(new Web3.providers.HttpProvider(web3Provider))
    // this.eth = promisifyAll(this.web3.eth)
    // this.smtpHandleAuth = smtpHandleAuth.bind(this)
    // this.smtpServer = smtpServer.bind(this)
    // this.smtpServer({
    //   onAuth: this.smtpHandleAuth
    // })


    _this.gittokenSQLite = _index7.default.bind(_this);
    _this.gittokenHyperlog = _index8.gittokenHyperlog.bind(_this);
    _this.logMessage = _index8.logMessage.bind(_this);
    _this.logExchange = _index8.logExchange.bind(_this);
    _this.logVote = _index8.logVote.bind(_this);
    _this.handleLogin = _index9.handleLogin.bind(_this);
    _this.verifyContributor = _index10.verifyContributor.bind(_this);
    _this.handleVerification = _index9.handleVerification.bind(_this);
    _this.handleAuthentication = _index9.handleAuthentication.bind(_this);
    _this.handleContractDetails = _index9.handleContractDetails.bind(_this);

    _this.gittokenHyperlog({});

    _this.socketHandler = _index2.socketHandler.bind(_this);
    _this.socketRouter = _index2.socketRouter.bind(_this);
    _this.socketHandler({}

    // Bind event methods to class scope

    );_this.ping = _index9.ping.bind(_this);
    _this.push = _index9.push.bind(_this);
    _this.pullRequest = _index9.pullRequest.bind(_this);_this.getSavedContract = _index10.getSavedContract.bind(_this);
    _this.createGitTokenContract = _index10.createGitTokenContract.bind(_this);
    _this.saveContractDetails = _index10.saveContractDetails.bind(_this);
    _this.retrieveDetails = _index3.retrieveDetails.bind(_this);
    _this.parsePushEvent = _index3.parsePushEvent.bind(_this);
    _this.parseRepositoryStats = _index3.parseRepositoryStats.bind(_this);
    _this.parseGitHubEvents = _index3.parseGitHubEvents.bind(_this);
    _this.retrieveGitHubUser = _index3.retrieveGitHubUser.bind(_this);
    _this.faucet = _index3.faucet.bind(_this);
    _this.generateReward = _index10.generateReward.bind(_this);
    _this.calculateRewardBonus = _index3.calculateRewardBonus.bind(_this);
    _this.gittokenAPI = _index5.default.bind(_this);_this.middlewareState = {
      accounts: {},
      contract: {},
      blockchain: {}
    };

    return _this;
  }

  (0, _createClass3.default)(GitTokenMiddleware, [{
    key: 'routeRequests',
    value: function routeRequests() {
      var _this2 = this;

      var router = (0, _express.Router)();

      router.post('/verify/:address', function (req, res) {
        _this2.handleVerification({
          user: req.user,
          address: req.params.address
        }).then(function (authStatus) {
          var code = authStatus.code;

          res.status(code).send(authStatus);
        }).catch(function (error) {
          res.status(500).send(error);
        });
      });

      router.post('/', function (req, res, next) {
        var headers = req.headers,
            body = req.body;

        _bluebird2.default.resolve().then(function () {
          if (_this2.isGitHubHook) {
            // console.log('GitHub WebHook Request')
            return _this2.handleGitHubWebHookEvent({
              event: headers['x-github-event'],
              data: { headers: headers, body: body }
            });
          } else {
            throw new Error('Request not yet configured');
          }
        }).then(function (response) {
          res.status(200).send((0, _stringify2.default)(response, null, 2));
        }).catch(function (error) {
          console.log('routeRequests::error', error);
          res.status(500).send(error.message);
        });
      });

      router.post('/faucet/:address', function (req, res, next) {
        if (!_this2.faucetActive) {
          res.status(500).send((0, _stringify2.default)({
            message: 'Faucet is not active! Set { faucetActive: true } to enable'
          }, null, 2));
        } else {
          var from = void 0;
          _this2.importKeystore({}).then(function (_ks) {
            from = '0x' + _this2.ks.getAddresses()[0];
            return _this2.eth.getBalanceAsync(from);
          }).then(function (balance) {
            console.log('Balance of ' + from + '::balance', balance);
            if (balance.toNumber() > 2e16) {
              return _this2.signTransaction({
                to: '0x' + req.params.address,
                from: from,
                value: 2e16,
                gasLimit: 4e6,
                data: null
              });
            } else {
              res.status(500).send((0, _stringify2.default)({
                message: 'Faucet does not have enough funds! Send funds to ' + from,
                balance: balance
              }, null, 2));
            }
          }).then(function (signedTx) {
            console.log('`0x${signedTx}`', '0x' + signedTx);
            return _this2.eth.sendRawTransactionAsync('0x' + signedTx);
          }).then(function (txHash) {
            console.log('txHash', txHash);
            return _this2.getTransactionReceipt(txHash);
          }).then(function (txReceipt) {
            console.log('txReceipt', txReceipt);
            res.status(200).send(txReceipt);
          }).catch(function (error) {
            res.status(500).send(error);
          });
        }
      });

      router.use('/api/v1', this.gittokenAPI);

      return router;
    }
  }, {
    key: 'handleGitHubWebHookEvent',
    value: function handleGitHubWebHookEvent(_ref) {
      var _this3 = this;

      var event = _ref.event,
          data = _ref.data;

      return new _bluebird2.default(function (resolve, reject) {
        console.log('handleGitHubWebHookEvent::event', event);
        console.log('handleGitHubWebHookEvent::data', data);

        switch (event) {
          case 'ping':
            resolve(_this3.ping(data));
            break;
          default:
            resolve(_this3.generateReward({
              rewardType: event,
              deliveryID: data['headers']['x-github-delivery'],
              contributorUsername: data['body']['sender']['login'],
              rewardBonus: 0
            })
            // let error = new Error('Invalid Event Found')
            // reject(error)
            );}
      });
    }
  }]);
  return GitTokenMiddleware;
}(_KeystoreGenerator3.default);

exports.default = GitTokenMiddleware;
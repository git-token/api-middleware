'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _stringify = require('babel-runtime/core-js/json/stringify');

var _stringify2 = _interopRequireDefault(_stringify);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _web = require('web3');

var _web2 = _interopRequireDefault(_web);

var _express = require('express');

var _express2 = _interopRequireDefault(_express);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _KeystoreGenerator2 = require('./KeystoreGenerator');

var _KeystoreGenerator3 = _interopRequireDefault(_KeystoreGenerator2);

var _index = require('./analytics/index');

var _index2 = _interopRequireDefault(_index);

var _configure = require('./analytics/configure');

var _configure2 = _interopRequireDefault(_configure);

var _index3 = require('./smtp/index');

var _index4 = require('./websocket/index');

var _index5 = require('./utils/index');

var _index6 = require('./api/index');

var _index7 = _interopRequireDefault(_index6);

var _index8 = require('./hyperlog/index');

var _index9 = require('./events/index');

var _index10 = require('./contract/index');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var GitTokenContract = '{\n  "contract_name": "GitToken",\n  "abi": [\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_rewardType",\n          "type": "string"\n        }\n      ],\n      "name": "getRewardDetails",\n      "outputs": [\n        {\n          "name": "",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [],\n      "name": "name",\n      "outputs": [\n        {\n          "name": "",\n          "type": "string"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_spender",\n          "type": "address"\n        },\n        {\n          "name": "_value",\n          "type": "uint256"\n        }\n      ],\n      "name": "approve",\n      "outputs": [],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [],\n      "name": "totalSupply",\n      "outputs": [\n        {\n          "name": "",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_username",\n          "type": "string"\n        }\n      ],\n      "name": "getContributorAddress",\n      "outputs": [\n        {\n          "name": "",\n          "type": "address"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_from",\n          "type": "address"\n        },\n        {\n          "name": "_to",\n          "type": "address"\n        },\n        {\n          "name": "_value",\n          "type": "uint256"\n        }\n      ],\n      "name": "transferFrom",\n      "outputs": [],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [],\n      "name": "organization",\n      "outputs": [\n        {\n          "name": "",\n          "type": "string"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [],\n      "name": "decimals",\n      "outputs": [\n        {\n          "name": "",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_contributorAddress",\n          "type": "address"\n        }\n      ],\n      "name": "getContributorUsername",\n      "outputs": [\n        {\n          "name": "",\n          "type": "string"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_rewardValue",\n          "type": "uint256"\n        },\n        {\n          "name": "_rewardType",\n          "type": "string"\n        }\n      ],\n      "name": "setRewardValue",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "",\n          "type": "address"\n        }\n      ],\n      "name": "owner",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_contributor",\n          "type": "address"\n        }\n      ],\n      "name": "balanceOf",\n      "outputs": [\n        {\n          "name": "",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_username",\n          "type": "string"\n        }\n      ],\n      "name": "getUnclaimedRewards",\n      "outputs": [\n        {\n          "name": "",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [],\n      "name": "symbol",\n      "outputs": [\n        {\n          "name": "",\n          "type": "string"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_to",\n          "type": "address"\n        },\n        {\n          "name": "_value",\n          "type": "uint256"\n        }\n      ],\n      "name": "transfer",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_username",\n          "type": "string"\n        },\n        {\n          "name": "_code",\n          "type": "bytes"\n        }\n      ],\n      "name": "setContributor",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_reservedValue",\n          "type": "uint256"\n        },\n        {\n          "name": "_rewardType",\n          "type": "string"\n        },\n        {\n          "name": "_reservedType",\n          "type": "string"\n        }\n      ],\n      "name": "setReservedValue",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_contributor",\n          "type": "address"\n        },\n        {\n          "name": "_username",\n          "type": "string"\n        }\n      ],\n      "name": "verifyContributor",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": true,\n      "inputs": [\n        {\n          "name": "_owner",\n          "type": "address"\n        },\n        {\n          "name": "_spender",\n          "type": "address"\n        }\n      ],\n      "name": "allowance",\n      "outputs": [\n        {\n          "name": "",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "_username",\n          "type": "string"\n        },\n        {\n          "name": "_rewardType",\n          "type": "string"\n        },\n        {\n          "name": "_reservedType",\n          "type": "string"\n        },\n        {\n          "name": "_rewardBonus",\n          "type": "uint256"\n        },\n        {\n          "name": "_deliveryID",\n          "type": "string"\n        }\n      ],\n      "name": "rewardContributor",\n      "outputs": [\n        {\n          "name": "",\n          "type": "bool"\n        }\n      ],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "name": "newOwner",\n          "type": "address"\n        }\n      ],\n      "name": "transferOwnership",\n      "outputs": [],\n      "payable": false,\n      "type": "function"\n    },\n    {\n      "inputs": [\n        {\n          "name": "_contributor",\n          "type": "address"\n        },\n        {\n          "name": "_name",\n          "type": "string"\n        },\n        {\n          "name": "_username",\n          "type": "string"\n        },\n        {\n          "name": "_organization",\n          "type": "string"\n        },\n        {\n          "name": "_symbol",\n          "type": "string"\n        },\n        {\n          "name": "_decimals",\n          "type": "uint256"\n        }\n      ],\n      "payable": false,\n      "type": "constructor"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": true,\n          "name": "owner",\n          "type": "address"\n        },\n        {\n          "indexed": true,\n          "name": "spender",\n          "type": "address"\n        },\n        {\n          "indexed": false,\n          "name": "value",\n          "type": "uint256"\n        }\n      ],\n      "name": "Approval",\n      "type": "event"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": true,\n          "name": "from",\n          "type": "address"\n        },\n        {\n          "indexed": true,\n          "name": "to",\n          "type": "address"\n        },\n        {\n          "indexed": false,\n          "name": "value",\n          "type": "uint256"\n        }\n      ],\n      "name": "Transfer",\n      "type": "event"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": true,\n          "name": "contributor",\n          "type": "address"\n        },\n        {\n          "indexed": false,\n          "name": "username",\n          "type": "string"\n        },\n        {\n          "indexed": false,\n          "name": "value",\n          "type": "uint256"\n        },\n        {\n          "indexed": false,\n          "name": "reservedValue",\n          "type": "uint256"\n        },\n        {\n          "indexed": false,\n          "name": "date",\n          "type": "uint256"\n        },\n        {\n          "indexed": false,\n          "name": "rewardType",\n          "type": "string"\n        }\n      ],\n      "name": "Contribution",\n      "type": "event"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": true,\n          "name": "contributor",\n          "type": "address"\n        },\n        {\n          "indexed": false,\n          "name": "username",\n          "type": "string"\n        },\n        {\n          "indexed": false,\n          "name": "date",\n          "type": "uint256"\n        }\n      ],\n      "name": "ContributorVerified",\n      "type": "event"\n    },\n    {\n      "anonymous": false,\n      "inputs": [\n        {\n          "indexed": false,\n          "name": "rewardType",\n          "type": "string"\n        },\n        {\n          "indexed": false,\n          "name": "reservedType",\n          "type": "string"\n        },\n        {\n          "indexed": false,\n          "name": "value",\n          "type": "uint256"\n        },\n        {\n          "indexed": false,\n          "name": "date",\n          "type": "uint256"\n        }\n      ],\n      "name": "RewardValueSet",\n      "type": "event"\n    }\n  ],\n  "unlinked_binary": "0x606060405234156200000d57fe5b604051620026ba380380620026ba83398101604090815281516020830151918301516060840151608085015160a0860151939594850194928301939183019201905b5b600160a060020a0333166000908152602081905260409020805460ff191660011790555b600160a060020a03861615620000a857600160a060020a0386166000908152602081905260409020805460ff191660011790555b60006001558451620000c2906003906020880190620001dd565b508251620000d8906004906020860190620001dd565b508151620000ee906005906020850190620001dd565b506002819055600160a060020a033316600090815260086020908152604090912085516200011f92870190620001dd565b50600160a060020a038616600090815260086020908152604090912085516200014b92870190620001dd565b50856001600801856040518082805190602001908083835b60208310620001845780518252601f19909201916020918201910162000163565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092208054600160a060020a031916600160a060020a03949094169390931790925550505b50505050505062000287565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200022057805160ff191683800117855562000250565b8280016001018555821562000250579182015b828111156200025057825182559160200191906001019062000233565b5b506200025f92915062000263565b5090565b6200028491905b808211156200025f57600081556001016200026a565b5090565b90565b61242380620002976000396000f300606060405236156101015763ffffffff60e060020a600035041663025dabae811461010357806306fdde031461016b578063095ea7b3146101fb57806318160ddd1461021c5780631e923ded1461023e57806323b872dd146102b057806323bd4d7a146102d7578063313ce5671461036757806355ded44d1461038957806366253c4414610425578063666e1b391461049057806370a08231146104c057806376500a7e146104ee57806395d89b4114610556578063a9059cbb146105e6578063b0cd70fd14610619578063cdf25db3146106c0578063d85600ca14610768578063dd62ed3e146107dc578063e9dc1a9514610810578063f2fde38b14610936575bfe5b341561010b57fe5b610159600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284375094965061095495505050505050565b60408051918252519081900360200190f35b341561017357fe5b61017b6109c1565b6040805160208082528351818301528351919283929083019185019080838382156101c1575b8051825260208311156101c157601f1990920191602091820191016101a1565b505050905090810190601f1680156101ed5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561020357fe5b61021a600160a060020a0360043516602435610a5a565b005b341561022457fe5b610159610b10565b60408051918252519081900360200190f35b341561024657fe5b610294600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843750949650610b1795505050505050565b60408051600160a060020a039092168252519081900360200190f35b34156102b857fe5b61021a600160a060020a0360043581169060243516604435610b8d565b005b34156102df57fe5b61017b610bff565b6040805160208082528351818301528351919283929083019185019080838382156101c1575b8051825260208311156101c157601f1990920191602091820191016101a1565b505050905090810190601f1680156101ed5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561036f57fe5b610159610c98565b60408051918252519081900360200190f35b341561039157fe5b61017b600160a060020a0360043516610c9f565b6040805160208082528351818301528351919283929083019185019080838382156101c1575b8051825260208311156101c157601f1990920191602091820191016101a1565b505050905090810190601f1680156101ed5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561042d57fe5b60408051602060046024803582810135601f810185900485028601850190965285855261047c9583359593946044949392909201918190840183828082843750949650610d5195505050505050565b604080519115158252519081900360200190f35b341561049857fe5b61047c600160a060020a0360043516610ea5565b604080519115158252519081900360200190f35b34156104c857fe5b610159600160a060020a0360043516610eba565b60408051918252519081900360200190f35b34156104f657fe5b610159600480803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843750949650610ed995505050505050565b60408051918252519081900360200190f35b341561055e57fe5b61017b610f46565b6040805160208082528351818301528351919283929083019185019080838382156101c1575b8051825260208311156101c157601f1990920191602091820191016101a1565b505050905090810190601f1680156101ed5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156105ee57fe5b61047c600160a060020a0360043516602435610fdf565b604080519115158252519081900360200190f35b341561062157fe5b61047c600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284375050604080516020601f89358b0180359182018390048302840183019094528083529799988101979196509182019450925082915084018382808284375094965061105395505050505050565b604080519115158252519081900360200190f35b34156106c857fe5b60408051602060046024803582810135601f810185900485028601850190965285855261047c958335959394604494939290920191819084018382808284375050604080516020601f89358b0180359182018390048302840183019094528083529799988101979196509182019450925082915084018382808284375094965061108295505050505050565b604080519115158252519081900360200190f35b341561077057fe5b60408051602060046024803582810135601f810185900485028601850190965285855261047c958335600160a060020a0316959394604494939290920191819084018382808284375094965061129595505050505050565b604080519115158252519081900360200190f35b34156107e457fe5b610159600160a060020a03600435811690602435166113a3565b60408051918252519081900360200190f35b341561081857fe5b61047c600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284375050604080516020601f89358b0180359182018390048302840183019094528083529799988101979196509182019450925082915084018382808284375050604080516020601f89358b0180359182018390048302840183019094528083529799988101979196509182019450925082915084018382808284375050604080516020601f818a01358b0180359182018390048302840183018552818452989a8a359a9099940197509195509182019350915081908401838280828437509496506113d095505050505050565b604080519115158252519081900360200190f35b341561093e57fe5b61021a600160a060020a0360043516611711565b005b60006001600501826040518082805190602001908083835b6020831061098b5780518252601f19909201916020918201910161096c565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054925050505b919050565b6109c9612305565b6003805460408051602060026001851615610100026000190190941693909304601f81018490048402820184019092528181529291830182828015610a4f5780601f10610a2457610100808354040283529160200191610a4f565b820191906000526020600020905b815481529060010190602001808311610a3257829003601f168201915b505050505090505b90565b60406044361015610a6b5760006000fd5b600082118015610aa05750600160a060020a033381166000908152600a60209081526040808320938716835292905290812054115b15610aab5760006000fd5b600160a060020a033381166000818152600a6020908152604080832094881680845294825291829020869055815186815291517f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259281900390910190a35b5b5b505050565b6001545b90565b60006001600801826040518082805190602001908083835b60208310610b4e5780518252601f199092019160209182019101610b2f565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054600160a060020a0316925050505b919050565b60606064361015610b9e5760006000fd5b610bb1600185858563ffffffff61179816565b1515610bbd5760006000fd5b82600160a060020a031684600160a060020a03166000805160206123d8833981519152846040518082815260200191505060405180910390a35b5b5b50505050565b610c07612305565b6004805460408051602060026001851615610100026000190190941693909304601f81018490048402820184019092528181529291830182828015610a4f5780601f10610a2457610100808354040283529160200191610a4f565b820191906000526020600020905b815481529060010190602001808311610a3257829003601f168201915b505050505090505b90565b6002545b90565b610ca7612305565b600160a060020a03821660009081526008602090815260409182902080548351601f600260001961010060018616150201909316929092049182018490048402810184019094528084529091830182828015610d445780601f10610d1957610100808354040283529160200191610d44565b820191906000526020600020905b815481529060010190602001808311610d2757829003601f168201915b505050505090505b919050565b600160a060020a03331660009081526020819052604081205460ff161515610d795760006000fd5b826001600501836040518082805190602001908083835b60208310610daf5780518252601f199092019160209182019101610d90565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020819055506000805160206123b8833981519152828442604051808060200180602001858152602001848152602001838103835286818151815260200191508051906020019080838360008314610e53575b805182526020831115610e5357601f199092019160209182019101610e33565b505050905090810190601f168015610e7f5780820380516001836020036101000a031916815260200191505b5092830390525060008152604051908190036020019350915050a15060015b5b92915050565b60006020819052908152604090205460ff1681565b600160a060020a0381166000908152600b60205260409020545b919050565b60006001600b01826040518082805190602001908083835b6020831061098b5780518252601f19909201916020918201910161096c565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054925050505b919050565b610f4e612305565b6005805460408051602060026001851615610100026000190190941693909304601f81018490048402820184019092528181529291830182828015610a4f5780601f10610a2457610100808354040283529160200191610a4f565b820191906000526020600020905b815481529060010190602001808311610a3257829003601f168201915b505050505090505b90565b600060406044361015610ff25760006000fd5b6110046001858563ffffffff61187d16565b15156110105760006000fd5b83600160a060020a031633600160a060020a03166000805160206123d8833981519152856040518082815260200191505060405180910390a35b5b5b5092915050565b60006110676001848463ffffffff61190516565b15156110735760006000fd5b506001610e9e565b5b92915050565b600160a060020a03331660009081526020819052604081205460ff1615156110aa5760006000fd5b836001600601846040518082805190602001908083835b602083106110e05780518252601f1990920191602091820191016110c1565b51815160209384036101000a6000190180199092169116179052920194855250604051938490038101842087519094889450925082918401908083835b6020831061113c5780518252601f19909201916020918201910161111d565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020819055506000805160206123b8833981519152838386426040518080602001806020018581526020018481526020018381038352878181518152602001915080519060200190808383600083146111e1575b8051825260208311156111e157601f1990920191602091820191016111c1565b505050905090810190601f16801561120d5780820380516001836020036101000a031916815260200191505b508381038252865181528651602091820191880190808383821561124c575b80518252602083111561124c57601f19909201916020918201910161122c565b505050905090810190601f1680156112785780820380516001836020036101000a031916815260200191505b50965050505050505060405180910390a15060015b5b9392505050565b600160a060020a03331660009081526020819052604081205460ff1615156112bd5760006000fd5b6112cf6001848463ffffffff611c1716565b15156112db5760006000fd5b82600160a060020a03167fce96c271d8db9db4a90e538f30d7ec5a63f116893c4636688d9ce1502b5cc93683426040518080602001838152602001828103825284818151815260200191508051906020019080838360008314611359575b80518252602083111561135957601f199092019160209182019101611339565b505050905090810190601f1680156113855780820380516001836020036101000a031916815260200191505b50935050505060405180910390a2506001610e9e565b5b5b92915050565b600160a060020a038083166000908152600a60209081526040808320938516835292905220545b92915050565b600160a060020a03331660009081526020819052604081205481908190819060ff1615156113fe5760006000fd5b61141360018a8a8a8a8a63ffffffff611e7316565b151561141f5760006000fd5b6001600801896040518082805190602001908083835b602083106114545780518252601f199092019160209182019101611435565b51815160209384036101000a60001901801990921691161790529201948552506040519384900381018420548c51600160a060020a0390911697506114fb948b9450600693508d92909182918401908083835b602083106114c65780518252601f1990920191602091820191016114a7565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054929150506122bf565b91506001600601886040518082805190602001908083835b602083106115325780518252601f199092019160209182019101611513565b51815160209384036101000a600019018019909216911617905292019485525060405193849003810184208b5190948c9450925082918401908083835b6020831061158e5780518252601f19909201916020918201910161156f565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902054905082600160a060020a03167f270e8b0620bd7a85855d0ae9401e7fa30ea6319fbf06c05f38cad80875f1cc018a8484428d604051808060200186815260200185815260200184815260200180602001838103835288818151815260200191508051906020019080838360008314611655575b80518252602083111561165557601f199092019160209182019101611635565b505050905090810190601f1680156116815780820380516001836020036101000a031916815260200191505b50838103825284518152845160209182019186019080838382156116c0575b8051825260208311156116c057601f1990920191602091820191016116a0565b505050905090810190601f1680156116ec5780820380516001836020036101000a031916815260200191505b5097505050505050505060405180910390a2600193505b5b5b50505095945050505050565b600160a060020a03331660009081526020819052604090205460ff1615156117395760006000fd5b600160a060020a03811660009081526020819052604090205460ff16151561179357600160a060020a03808216600090815260208190526040808220805460ff199081166001179091553390931682529020805490911690555b5b5b50565b600160a060020a0380841660009081526009860160209081526040808320339094168352929052908120546117d3818463ffffffff6122db16565b600160a060020a038087166000908152600989016020908152604080832033851684528252808320949094559187168152600a8901909152205461181d908463ffffffff6122bf16565b600160a060020a038086166000908152600a890160205260408082209390935590871681522054611854908463ffffffff6122db16565b600160a060020a0386166000908152600a88016020526040902055600191505b50949350505050565b600160a060020a0333166000908152600a840160205260408120546118a8908363ffffffff6122db16565b600160a060020a033381166000908152600a8701602052604080822093909355908516815220546118df908363ffffffff6122bf16565b600160a060020a0384166000908152600a860160205260409020555060015b9392505050565b6000816040518082805190602001908083835b602083106119375780518252601f199092019160209182019101611918565b51815160209384036101000a60001901801990921691161790526040519190930181900381208851909550600c8a019450889391925082918401908083835b602083106119955780518252601f199092019160209182019101611976565b51815160209384036101000a60001901801990921691161790529201948552506040519384900301909220549290921491506119d390505760006000fd5b600084600b01846040518082805190602001908083835b60208310611a095780518252601f1990920191602091820191016119ea565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020541115611b5e57611acb84600b01846040518082805190602001908083835b60208310611a7a5780518252601f199092019160209182019101611a5b565b51815160209384036101000a6000190180199092169116179052920194855250604080519485900382019094205433600160a060020a03166000908152600a8b0190925293902054929150506122bf565b84600a01600033600160a060020a0316600160a060020a0316815260200190815260200160002081905550600084600b01846040518082805190602001908083835b60208310611b2c5780518252601f199092019160209182019101611b0d565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092209290925550505b600160a060020a033316600090815260078501602090815260409091208451611b8992860190612317565b503384600801846040518082805190602001908083835b60208310611bbf5780518252601f199092019160209182019101611ba0565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092208054600160a060020a031916600160a060020a0394909416939093179092555060019150505b9392505050565b6000600160a060020a0383161515611c2f5760006000fd5b600084600b01836040518082805190602001908083835b60208310611c655780518252601f199092019160209182019101611c46565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020541115611dba57611d2784600b01836040518082805190602001908083835b60208310611cd65780518252601f199092019160209182019101611cb7565b51815160209384036101000a60001901801990921691161790529201948552506040805194859003820190942054600160a060020a0389166000908152600a8b0190925293902054929150506122bf565b84600a01600085600160a060020a0316600160a060020a0316815260200190815260200160002081905550600084600b01836040518082805190602001908083835b60208310611d885780518252601f199092019160209182019101611d69565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092209290925550505b600160a060020a038316600090815260078501602090815260409091208351611de592850190612317565b508284600801836040518082805190602001908083835b60208310611bbf5780518252601f199092019160209182019101611ba0565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092208054600160a060020a031916600160a060020a0394909416939093179092555060019150505b9392505050565b6000600060006000611ee8868b6005018a6040518082805190602001908083835b602083106114c65780518252601f1990920191602091820191016114a7565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054929150506122bf565b925089600601886040518082805190602001908083835b60208310611f1e5780518252601f199092019160209182019101611eff565b51815160209384036101000a600019018019909216911617905292019485525060405193849003810184208b5190948c9450925082918401908083835b60208310611f7a5780518252601f199092019160209182019101611f5b565b51815160209384036101000a60001901801990921691161790529201948552506040519384900381018420548d5190965060088f01948e9450925082918401908083835b60208310611fdd5780518252601f199092019160209182019101611fbe565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054600160a060020a0316925050508215156120235760006000fd5b89600d01856040518082805190602001908083835b602083106120575780518252601f199092019160209182019101612038565b51815160001960209485036101000a0190811690199190911617905292019485525060405193849003019092205460ff16151560011415915061209c90505760006000fd5b89546120c09083906120b4908663ffffffff6122bf16565b9063ffffffff6122bf16565b8a55600160a060020a0330166000908152600a8b0160205260409020546120ed908363ffffffff6122bf16565b600160a060020a033081166000908152600a8d016020526040902091909155811615156121ec57612181838b600b018b6040518082805190602001908083835b602083106114c65780518252601f1990920191602091820191016114a7565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054929150506122bf565b8a600b018a6040518082805190602001908083835b602083106121b55780518252601f199092019160209182019101612196565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922092909255506122339050565b600160a060020a0381166000908152600a8b016020526040902054612217908463ffffffff6122bf16565b600160a060020a0382166000908152600a8c0160205260409020555b60018a600d01866040518082805190602001908083835b602083106122695780518252601f19909201916020918201910161224a565b51815160209384036101000a60001901801990921691161790529201948552506040519384900301909220805460ff19169315159390931790925550600194506122b09050565b5b5b5050509695505050505050565b60008282016122d0848210156122f4565b8091505b5092915050565b60006122e9838311156122f4565b508082035b92915050565b8015156117935760006000fd5b5b50565b60408051602081019091526000815290565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061235857805160ff1916838001178555612385565b82800160010185558215612385579182015b8281111561238557825182559160200191906001019061236a565b5b50612392929150612396565b5090565b610a5791905b80821115612392576000815560010161239c565b5090565b905600bab878453bea46cf2222f6dd20b3fa8d80dc6ca2b5d4f854173f07227a21e1a6ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa165627a7a72305820a6a4b4719eeb3f4dcfcb490fbdf8a561f50456f37f08603ffc778b4c4de2938b0029",\n  "networks": {\n    "17": {\n      "links": {},\n      "events": {\n        "0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": true,\n              "name": "owner",\n              "type": "address"\n            },\n            {\n              "indexed": true,\n              "name": "spender",\n              "type": "address"\n            },\n            {\n              "indexed": false,\n              "name": "value",\n              "type": "uint256"\n            }\n          ],\n          "name": "Approval",\n          "type": "event"\n        },\n        "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": true,\n              "name": "from",\n              "type": "address"\n            },\n            {\n              "indexed": true,\n              "name": "to",\n              "type": "address"\n            },\n            {\n              "indexed": false,\n              "name": "value",\n              "type": "uint256"\n            }\n          ],\n          "name": "Transfer",\n          "type": "event"\n        },\n        "0xc3b4f845790d6659bd38fdced442a58d1b56a46a7052115d0e3c9e017adf4921": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": true,\n              "name": "contributor",\n              "type": "address"\n            },\n            {\n              "indexed": false,\n              "name": "username",\n              "type": "string"\n            },\n            {\n              "indexed": false,\n              "name": "value",\n              "type": "uint256"\n            },\n            {\n              "indexed": false,\n              "name": "date",\n              "type": "uint256"\n            },\n            {\n              "indexed": false,\n              "name": "rewardType",\n              "type": "string"\n            }\n          ],\n          "name": "Contribution",\n          "type": "event"\n        },\n        "0xce96c271d8db9db4a90e538f30d7ec5a63f116893c4636688d9ce1502b5cc936": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": true,\n              "name": "contributor",\n              "type": "address"\n            },\n            {\n              "indexed": false,\n              "name": "username",\n              "type": "string"\n            },\n            {\n              "indexed": false,\n              "name": "date",\n              "type": "uint256"\n            }\n          ],\n          "name": "ContributorVerified",\n          "type": "event"\n        },\n        "0xeb1d29659fe1e458a59d47ceab90b84b14e2eb79da4602088f9e9a8bcc228ca4": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": true,\n              "name": "contributor",\n              "type": "address"\n            },\n            {\n              "indexed": false,\n              "name": "value",\n              "type": "uint256"\n            },\n            {\n              "indexed": false,\n              "name": "date",\n              "type": "uint256"\n            },\n            {\n              "indexed": false,\n              "name": "rewardType",\n              "type": "string"\n            }\n          ],\n          "name": "Contribution",\n          "type": "event"\n        },\n        "0x270e8b0620bd7a85855d0ae9401e7fa30ea6319fbf06c05f38cad80875f1cc01": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": true,\n              "name": "contributor",\n              "type": "address"\n            },\n            {\n              "indexed": false,\n              "name": "username",\n              "type": "string"\n            },\n            {\n              "indexed": false,\n              "name": "value",\n              "type": "uint256"\n            },\n            {\n              "indexed": false,\n              "name": "reservedValue",\n              "type": "uint256"\n            },\n            {\n              "indexed": false,\n              "name": "date",\n              "type": "uint256"\n            },\n            {\n              "indexed": false,\n              "name": "rewardType",\n              "type": "string"\n            }\n          ],\n          "name": "Contribution",\n          "type": "event"\n        },\n        "0xbab878453bea46cf2222f6dd20b3fa8d80dc6ca2b5d4f854173f07227a21e1a6": {\n          "anonymous": false,\n          "inputs": [\n            {\n              "indexed": false,\n              "name": "rewardType",\n              "type": "string"\n            },\n            {\n              "indexed": false,\n              "name": "reservedType",\n              "type": "string"\n            },\n            {\n              "indexed": false,\n              "name": "value",\n              "type": "uint256"\n            },\n            {\n              "indexed": false,\n              "name": "date",\n              "type": "uint256"\n            }\n          ],\n          "name": "RewardValueSet",\n          "type": "event"\n        }\n      },\n      "updated_at": 1501719901554\n    }\n  },\n  "schema_version": "0.0.5",\n  "updated_at": 1501719901554\n}';
// import gittokenSQLite from './sqlite/index'

var GitTokenMiddleware = function (_KeystoreGenerator) {
  (0, _inherits3.default)(GitTokenMiddleware, _KeystoreGenerator);

  function GitTokenMiddleware(options) {
    (0, _classCallCheck3.default)(this, GitTokenMiddleware);

    var _this

    // bind utility methods to class scope


    /**
     * TODO Replace this with database
     */
    = (0, _possibleConstructorReturn3.default)(this, (GitTokenMiddleware.__proto__ || (0, _getPrototypeOf2.default)(GitTokenMiddleware)).call(this, options));

    var isGitHubHook = options.isGitHubHook,
        config = options.config,
        web3Provider = options.web3Provider,
        dirPath = options.dirPath,
        contractFile = options.contractFile,
        faucetActive = options.faucetActive,
        mysqlOpts = options.mysqlOpts;


    _this.mysqlOpts = mysqlOpts;
    _this.faucetActive = faucetActive;
    _this.dirPath = dirPath;
    _this.contractFile = contractFile;
    _this.gittokenContract = JSON.parse(GitTokenContract);
    _this.isGitHubHook = isGitHubHook;
    _this.config = config;

    // this.dirPath = dirPath
    // this.web3Provider = web3Provider
    // this.web3 = new Web3(new Web3.providers.HttpProvider(web3Provider))
    // this.eth = promisifyAll(this.web3.eth)
    // this.smtpHandleAuth = smtpHandleAuth.bind(this)
    // this.smtpServer = smtpServer.bind(this)
    // this.smtpServer({
    //   onAuth: this.smtpHandleAuth
    // })


    // this.gittokenSQLite = gittokenSQLite.bind(this)
    _this.gittokenHyperlog = _index8.gittokenHyperlog.bind(_this);
    _this.logMessage = _index8.logMessage.bind(_this);
    _this.logExchange = _index8.logExchange.bind(_this);
    _this.logVote = _index8.logVote.bind(_this);
    _this.handleLogin = _index9.handleLogin.bind(_this);
    _this.verifyContributor = _index10.verifyContributor.bind(_this);
    _this.handleVerification = _index9.handleVerification.bind(_this);
    _this.handleAuthentication = _index9.handleAuthentication.bind(_this);
    _this.handleContractDetails = _index9.handleContractDetails.bind(_this);

    _this.gittokenHyperlog({});

    _this.socketHandler = _index4.socketHandler.bind(_this);
    _this.socketRouter = _index4.socketRouter.bind(_this);
    _this.socketHandler({}

    // Setup Analytics Processor
    );_this.analyticsProcessor = _index2.default.bind(_this);
    _this.configureAnalytics = _configure2.default.bind(_this);
    _this.analyticsProcessor({}

    // Bind event methods to class scope
    );_this.ping = _index9.ping.bind(_this);
    _this.push = _index9.push.bind(_this);
    _this.pullRequest = _index9.pullRequest.bind(_this);
    _this.milestone = _index9.milestone.bind(_this);
    _this.organization = _index9.organization.bind(_this);_this.getSavedContract = _index10.getSavedContract.bind(_this);
    _this.createGitTokenContract = _index10.createGitTokenContract.bind(_this);
    _this.saveContractDetails = _index10.saveContractDetails.bind(_this);
    _this.retrieveDetails = _index5.retrieveDetails.bind(_this);
    _this.parsePushEvent = _index5.parsePushEvent.bind(_this);
    _this.parseRepositoryStats = _index5.parseRepositoryStats.bind(_this);
    _this.parseGitHubEvents = _index5.parseGitHubEvents.bind(_this);
    _this.retrieveGitHubUser = _index5.retrieveGitHubUser.bind(_this);
    _this.faucet = _index5.faucet.bind(_this);
    _this.generateReward = _index10.generateReward.bind(_this);
    _this.calculateRewardBonus = _index5.calculateRewardBonus.bind(_this);
    _this.gittokenAPI = _index7.default.bind(_this);_this.middlewareState = {
      accounts: {},
      contract: {},
      blockchain: {}
    };

    return _this;
  }

  (0, _createClass3.default)(GitTokenMiddleware, [{
    key: 'routeRequests',
    value: function routeRequests() {
      var _this2 = this;

      var router = (0, _express.Router)();

      router.post('/verify/:address', function (req, res) {
        _this2.handleVerification({
          user: req.user,
          address: req.params.address
        }).then(function (authStatus) {
          var code = authStatus.code,
              data = authStatus.data;

          res.status(code).send(data);
        }).catch(function (error) {
          console.log('/verify/:address::error', error);
          res.status(500).send(error);
        });
      });

      router.post('/', function (req, res, next) {
        var headers = req.headers,
            body = req.body;

        _bluebird2.default.resolve().then(function () {
          if (_this2.isGitHubHook) {
            // console.log('GitHub WebHook Request')
            return _this2.handleGitHubWebHookEvent({
              event: headers['x-github-event'],
              data: { headers: headers, body: body }
            });
          } else {
            throw new Error('Request not yet configured');
          }
        }).then(function (response) {
          res.status(200).send((0, _stringify2.default)(response, null, 2));
        }).catch(function (error) {
          console.log('routeRequests::error', error);
          res.status(500).send(error.message);
        });
      });

      router.post('/faucet/:address', function (req, res, next) {
        if (!_this2.faucetActive) {
          res.status(500).send((0, _stringify2.default)({
            message: 'Faucet is not active! Set { faucetActive: true } to enable'
          }, null, 2));
        } else {
          var from = void 0;
          _this2.importKeystore({}).then(function (_ks) {
            from = '0x' + _this2.ks.getAddresses()[0];
            return _this2.eth.getBalanceAsync(from);
          }).then(function (balance) {
            console.log('Balance of ' + from + '::balance', balance);
            if (balance.toNumber() > 2e16) {
              return _this2.signTransaction({
                to: '0x' + req.params.address,
                from: from,
                value: 2e16,
                gasLimit: 4e6,
                data: null
              });
            } else {
              res.status(500).send((0, _stringify2.default)({
                message: 'Faucet does not have enough funds! Send funds to ' + from,
                balance: balance
              }, null, 2));
            }
          }).then(function (signedTx) {
            // console.log('`0x${signedTx}`', `0x${signedTx}`)
            return _this2.eth.sendRawTransactionAsync('0x' + signedTx);
          }).then(function (txHash) {
            // console.log('txHash', txHash)
            return _this2.getTransactionReceipt(txHash);
          }).then(function (txReceipt) {
            // console.log('txReceipt', txReceipt)
            res.status(200).send(txReceipt);
          }).catch(function (error) {
            res.status(500).send(error);
          });
        }
      });

      router.use('/api/v1', this.gittokenAPI);

      return router;
    }
  }, {
    key: 'handleGitHubWebHookEvent',
    value: function handleGitHubWebHookEvent(_ref) {
      var _this3 = this;

      var event = _ref.event,
          data = _ref.data;

      return new _bluebird2.default(function (resolve, reject) {
        // console.log('handleGitHubWebHookEvent::event', event)
        // console.log('handleGitHubWebHookEvent::data', data)

        switch (event) {
          case 'ping':
            resolve(_this3.ping({ event: event, data: data }));
            break;
          case 'milestone':
            resolve(_this3.milestone({ event: event, data: data }));
            break;
          case 'organization':
            resolve(_this3.organization({ event: event, data: data }));
            break;
          default:
            resolve(_this3.generateReward({
              rewardType: event,
              deliveryID: data['headers']['x-github-delivery'],
              contributorUsername: data['body']['sender']['login'],
              rewardBonus: 0,
              reservedType: ''
            })
            // let error = new Error('Invalid Event Found')
            // reject(error)
            );}
      });
    }
  }]);
  return GitTokenMiddleware;
}(_KeystoreGenerator3.default);

exports.default = GitTokenMiddleware;